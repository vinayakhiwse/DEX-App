{"ast":null,"code":"// src/use-multiselect.ts\nimport { useCollator } from \"@react-aria/i18n\";\nimport { setInteractionModality } from \"@react-aria/interactions\";\nimport { useField } from \"@react-aria/label\";\nimport { useMenuTrigger } from \"@react-aria/menu\";\nimport { ListKeyboardDelegate, useTypeSelect } from \"@react-aria/selection\";\nimport { chain, filterDOMProps, mergeProps, useId } from \"@react-aria/utils\";\nimport { useMemo } from \"react\";\nfunction useMultiSelect(props, state, ref) {\n  const {\n    disallowEmptySelection,\n    isDisabled\n  } = props;\n  const collator = useCollator({\n    usage: \"search\",\n    sensitivity: \"base\"\n  });\n  const delegate = useMemo(() => new ListKeyboardDelegate(state.collection, state.disabledKeys, null, collator), [state.collection, state.disabledKeys, collator]);\n  const {\n    menuTriggerProps,\n    menuProps\n  } = useMenuTrigger({\n    isDisabled,\n    type: \"listbox\"\n  }, state, ref);\n  const triggerOnKeyDown = e => {\n    if (state.selectionMode === \"single\") {\n      switch (e.key) {\n        case \"ArrowLeft\":\n          {\n            e.preventDefault();\n            const key = state.selectedKeys.size > 0 ? delegate.getKeyAbove(state.selectedKeys.values().next().value) : delegate.getFirstKey();\n            if (key) {\n              state.setSelectedKeys([key]);\n            }\n            break;\n          }\n        case \"ArrowRight\":\n          {\n            e.preventDefault();\n            const key = state.selectedKeys.size > 0 ? delegate.getKeyBelow(state.selectedKeys.values().next().value) : delegate.getFirstKey();\n            if (key) {\n              state.setSelectedKeys([key]);\n            }\n            break;\n          }\n      }\n    }\n  };\n  const {\n    typeSelectProps\n  } = useTypeSelect({\n    keyboardDelegate: delegate,\n    selectionManager: state.selectionManager,\n    onTypeSelect(key) {\n      state.setSelectedKeys([key]);\n    }\n  });\n  const {\n    labelProps,\n    fieldProps,\n    descriptionProps,\n    errorMessageProps\n  } = useField({\n    ...props,\n    labelElementType: \"span\"\n  });\n  typeSelectProps.onKeyDown = typeSelectProps.onKeyDownCapture;\n  delete typeSelectProps.onKeyDownCapture;\n  const domProps = filterDOMProps(props, {\n    labelable: true\n  });\n  const triggerProps = mergeProps(typeSelectProps, menuTriggerProps, fieldProps);\n  const valueId = useId();\n  return {\n    labelProps: {\n      ...labelProps,\n      onClick: () => {\n        var _a;\n        if (!props.isDisabled) {\n          (_a = ref.current) == null ? void 0 : _a.focus();\n          setInteractionModality(\"keyboard\");\n        }\n      }\n    },\n    triggerProps: mergeProps(domProps, {\n      ...triggerProps,\n      onKeyDown: chain(triggerProps.onKeyDown, triggerOnKeyDown, props.onKeyDown),\n      onKeyUp: props.onKeyUp,\n      \"aria-labelledby\": [valueId, domProps[\"aria-label\"] !== void 0 ? domProps[\"aria-labelledby\"] !== void 0 ? domProps[\"aria-labelledby\"] : triggerProps.id : triggerProps[\"aria-labelledby\"]].join(\" \"),\n      onFocus(e) {\n        if (state.isFocused) {\n          return;\n        }\n        if (props.onFocus) {\n          props.onFocus(e);\n        }\n        state.setFocused(true);\n      },\n      onBlur(e) {\n        if (state.isOpen) {\n          return;\n        }\n        if (props.onBlur) {\n          props.onBlur(e);\n        }\n        state.setFocused(false);\n      }\n    }),\n    valueProps: {\n      id: valueId\n    },\n    menuProps: {\n      ...menuProps,\n      disallowEmptySelection,\n      autoFocus: state.focusStrategy || true,\n      shouldSelectOnPressUp: true,\n      shouldFocusOnHover: true,\n      onBlur: e => {\n        if (e.currentTarget.contains(e.relatedTarget)) {\n          return;\n        }\n        if (props.onBlur) {\n          props.onBlur(e);\n        }\n        state.setFocused(false);\n      },\n      onFocus: menuProps == null ? void 0 : menuProps.onFocus,\n      \"aria-labelledby\": [fieldProps[\"aria-labelledby\"], triggerProps[\"aria-label\"] && !fieldProps[\"aria-labelledby\"] ? triggerProps.id : null].filter(Boolean).join(\" \")\n    },\n    descriptionProps,\n    errorMessageProps\n  };\n}\nexport { useMultiSelect };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}